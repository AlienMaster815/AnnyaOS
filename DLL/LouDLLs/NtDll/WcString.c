#include "ntdll.h"

static const UINT16 NtWcTypes[256] = {
    //00
    0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020,
    0x0020, 0x0068, 0x0028, 0x0028, 0x0028, 0x0028, 0x0020, 0x0020,
    //10
    0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020,
    0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020,
    //20
    0x0048, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010,
    0x0010, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010,
    //30
    0x0084, 0x0084, 0x0084, 0x0084, 0x0084, 0x0084, 0x0084, 0x0084,
    0x0084, 0x0084, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010,
    //40
    0x0010, 0x0181, 0x0181, 0x0181, 0x0181, 0x0181, 0x0181, 0x0101,
    0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101,
    //50
    0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101,
    0x0101, 0x0101, 0x0101, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010,
    //60
    0x0010, 0x0182, 0x0182, 0x0182, 0x0182, 0x0182, 0x0182, 0x0102,
    0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102,
    //70
    0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102,
    0x0102, 0x0102, 0x0102, 0x0010, 0x0010, 0x0010, 0x0010, 0x0020,
    //80
    0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020,
    0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020,
    //90
    0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020,
    0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020,
    //A0 
    0x0048, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010,
    0x0010, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010,
    //B0
    0x0010, 0x0010, 0x0014, 0x0014, 0x0010, 0x0010, 0x0010, 0x0010,
    0x0010, 0x0014, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010, 0x0010,
    //C0
    0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101,
    0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101,
    //D0
    0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0010,
    0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0101, 0x0102,
    //E0
    0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102,
    0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102,
    //F0
    0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0010,
    0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102, 0x0102
}; 

NTDLL_API
int 
_wcsicmp(LPCWSTR String1, LPCWSTR String2){
    wchar_t Char1, Char2;
    size_t i = 0;
    while(1){
        Char1 = ((String1[i] >= 'A') && (String1[i] <= 'Z')) ? String1[i] + 32 : String1[i];
        Char2 = ((String2[i] >= 'A') && (String2[i] <= 'Z')) ? String2[i] + 32 : String2[i];
        if((Char1 !=Char2) || (!*String1)){
            return Char1 - Char2;
        }
        i++;
    }
    return 0x00;
}

NTDLL_API
size_t 
wcsnlen(
    LPCWSTR Str,
    size_t Length
){
    size_t i = 0;
    while((Str[i]) && (Length)){
        i++;
        Length--;
    }
    return i - (size_t)Str;
}

NTDLL_API
LPWSTR 
_wcslwr(
    LPWSTR Str
){
    LPWSTR Result = Str;
    for ( ; *Str; Str++) if (*Str >= 'A' && *Str <= 'Z') *Str += 'a' - 'A';
    return Result;
}

NTDLL_API
int 
_wcslwr_s(wchar_t* Str, size_t Length){

    if(!Str){
        return 22;//EINVAL
    }

    if(wcsnlen(Str, Length) == Length){
        *Str = 0x00;
        return 22;//EINVAL
    }

    _wcslwr(Str);

    return 0x00;
}

NTDLL_API
LPWSTR 
_wcsupr(
    LPWSTR Str
){
    LPWSTR Result = Str;
    for ( ; *Str; Str++) if (*Str >= 'a' && *Str <= 'z') *Str += 'A' - 'a';
    return Result;
}

NTDLL_API
int 
_wcsupr_s(
    LPWSTR Str,
    size_t Length
){

    if(!Str){
        return 22;//EINVAL
    }

    if(wcsnlen(Str, Length) == Length){
        *Str = 0x00;
        return 22;//EINVAL
    }

    _wcsupr(Str);
    return 0x00;
}

//184